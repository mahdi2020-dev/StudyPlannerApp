# راهنمای بهبود نسخه ویندوز (EXE) پرشین لایف منیجر

## تغییرات جدید:

### 1. بهبود نحوه تشخیص ویژگی‌های کلاس User
- افزودن فیلد `username` به کلاس User برای حل خطای `User object has no attribute username`
- اضافه کردن بررسی‌های امنیتی هنگام دسترسی به ویژگی‌های کلاس User
- حل مشکل مقدار پیش‌فرض `login_time` از `None` به رشته خالی
- بهبود مدیریت خطاها با بررسی وجود ویژگی‌ها قبل از دسترسی به آنها

### 2. اضافه کردن فایل startup_fix.py
- تشخیص خودکار محیط اجرا (Replit یا ویندوز)
- تست وجود ویژگی‌های کلاس User قبل از اجرای برنامه
- مدیریت خطاها و لاگ‌گذاری دقیق‌تر

### 3. اصلاح فایل‌های اصلی
- تغییر کد در فایل `login_window.py` برای دسترسی ایمن به ویژگی‌ها
- اضافه کردن بررسی‌های قبل از دسترسی به ویژگی‌های `login_time` و `metadata`
- بهبود مدیریت استثناها در کدهای مدیریت ورود

## نحوه استفاده:

### ساخت فایل exe
برای ساخت نسخه جدید exe با تغییرات بهبود یافته، مراحل زیر را انجام دهید:

1. فایل `updated_create_exe.py` را اجرا کنید:
```
python updated_create_exe.py
```

2. فایل exe ایجاد شده در مسیر `dist/Persian Life Manager` قرار خواهد گرفت

### اجرای با فایل startup_fix.py
برای اجرای برنامه با تشخیص خودکار محیط:

```
python startup_fix.py
```

این اسکریپت به طور خودکار مناسب‌ترین روش اجرا را تشخیص می‌دهد:
- در Replit: نسخه وب را اجرا می‌کند
- در ویندوز: نسخه دسکتاپ بهینه‌شده را اجرا می‌کند
- در سایر سیستم‌عامل‌ها: نسخه دسکتاپ معمولی را اجرا می‌کند

## حل مشکلات احتمالی:

اگر همچنان با خطای "User object has no attribute username" مواجه شدید:

1. فایل `app/core/auth.py` را بررسی کنید و مطمئن شوید که در تابع `__init__` کلاس User، خط زیر وجود دارد:
```python
self.username = name  # برای سازگاری با کدهای قبلی که از username استفاده می‌کنند
```

2. اطمینان حاصل کنید که همه جا از hasattr استفاده شده باشد:
```python
if hasattr(user, 'username'):
    username = user.username
else:
    username = getattr(user, 'name', 'کاربر')
```

3. مطمئن شوید که از نسخه بهبود یافته `run_desktop_fix.py` به جای نسخه اصلی استفاده می‌کنید

4. لاگ‌ها را بررسی کنید تا مشکل دقیق را پیدا کنید. لاگ‌ها در مسیر زیر قرار دارند:
```
~/.persian_life_manager/app.log
```